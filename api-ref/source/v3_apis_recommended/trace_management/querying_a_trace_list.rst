:original_name: cts_api_0311.html

.. _cts_api_0311:

Querying a Trace List
=====================

Function
--------

This API is used to query records of operations on resources in the last seven days.

URI
---

GET /v3/{project_id}/traces

.. table:: **Table 1** Path parameter

   +------------+-----------+--------+--------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                                |
   +============+===========+========+============================================================================================+
   | project_id | Yes       | String | Project ID. For details, see :ref:`Obtaining an Account ID and Project ID <cts_api_0005>`. |
   +------------+-----------+--------+--------------------------------------------------------------------------------------------+

.. table:: **Table 2** Query parameters

   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                                                                                                                                                                                                                    |
   +=================+=================+=================+================================================================================================================================================================================================================================================================================================================================+
   | trace_type      | Yes             | String          | Trace type. The value can be **system** (management trace).                                                                                                                                                                                                                                                                    |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | limit           | No              | Integer         | Number of traces to query. The default value is **10** and the maximum value is **200**.                                                                                                                                                                                                                                       |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | from            | No              | Long            | UTC millisecond timestamp of the query start time. The value contains 13 digits and the default value is the timestamp of the last hour. Traces generated after the specified timestamp will be queried. The parameters **from** and **to** should be used together.                                                           |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | next            | No              | String          | This parameter is used to query traces generated earlier than its specified value. The value can be that of **marker** in the response. **next** can be used with **from** and **to**. Traces generated in the overlap of the two time ranges specified respectively by **next** and by **from** and **to** will be returned.  |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | to              | No              | Long            | UTC millisecond timestamp of the query end time. The value contains 13 digits and the default value is the timestamp of the current time. Traces generated before the specified timestamp will be queried. The parameters **to** and **from** should be used together.                                                         |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | tracker_name    | No              | String          | When **trace_type** is set to **system**, the default value **system** is used.                                                                                                                                                                                                                                                |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | service_type    | No              | String          | Type of a cloud service whose traces are to be queried. The value must be the acronym of a cloud service that has been connected with CTS. It is a word composed of uppercase letters. For cloud services that can be connected with CTS, see section "Supported Services and Operations" in *Cloud Trace Service User Guide*. |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | user            | No              | String          | Name of the user whose traces are to be queried.                                                                                                                                                                                                                                                                               |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_id     | No              | String          | ID of a cloud resource whose traces are to be queried.                                                                                                                                                                                                                                                                         |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_name   | No              | String          | Name of a resource whose traces are to be queried. The value can contain uppercase letters.                                                                                                                                                                                                                                    |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_type   | No              | String          | Type of a resource whose traces are to be queried.                                                                                                                                                                                                                                                                             |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_id        | No              | String          | Trace ID. If this parameter is specified, other query criteria will not take effect.                                                                                                                                                                                                                                           |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_name      | No              | String          | Trace name. The value can contain uppercase letters.                                                                                                                                                                                                                                                                           |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_rating    | No              | String          | Trace status. The value can be **normal**, **warning**, or **incident**.                                                                                                                                                                                                                                                       |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                |
   |                 |                 |                 | Enumerated values:                                                                                                                                                                                                                                                                                                             |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                |
   |                 |                 |                 | -  **normal**                                                                                                                                                                                                                                                                                                                  |
   |                 |                 |                 | -  **warning**                                                                                                                                                                                                                                                                                                                 |
   |                 |                 |                 | -  **incident**                                                                                                                                                                                                                                                                                                                |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

None

Response Parameters
-------------------

**Status code: 200**

.. table:: **Table 3** Response body parameters

   +-----------+---------------------------------------------------------------------------------------------+-------------------------------------------+
   | Parameter | Type                                                                                        | Description                               |
   +===========+=============================================================================================+===========================================+
   | traces    | Array of :ref:`Traces <cts_api_0311__en-us_topic_0000001168237830_response_traces>` objects | List of returned traces.                  |
   +-----------+---------------------------------------------------------------------------------------------+-------------------------------------------+
   | meta_data | :ref:`MetaData <cts_api_0311__en-us_topic_0000001168237830_response_metadata>` object       | Number of returned traces and the marker. |
   +-----------+---------------------------------------------------------------------------------------------+-------------------------------------------+

.. _cts_api_0311__en-us_topic_0000001168237830_response_traces:

.. table:: **Table 4** Traces

   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Type                                                                                  | Description                                                                                                                                                                            |
   +=======================+=======================================================================================+========================================================================================================================================================================================+
   | resource_id           | String                                                                                | ID of a cloud resource on which the recorded operation was performed.                                                                                                                  |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_name            | String                                                                                | Trace name. The value can contain 1 to 64 characters, including letters, digits, hyphens (-), underscores (_), and periods (.). It must start with a letter.                           |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_rating          | String                                                                                | Trace status. The value can be **normal**, **warning**, or **incident**.                                                                                                               |
   |                       |                                                                                       |                                                                                                                                                                                        |
   |                       |                                                                                       | Enumerated values:                                                                                                                                                                     |
   |                       |                                                                                       |                                                                                                                                                                                        |
   |                       |                                                                                       | -  **normal**                                                                                                                                                                          |
   |                       |                                                                                       | -  **warning**                                                                                                                                                                         |
   |                       |                                                                                       | -  **incident**                                                                                                                                                                        |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_type            | String                                                                                | Trace source. For management traces, the value can be **ApiCall**, **ConsoleAction**, or **SystemAction**.                                                                             |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | request               | String                                                                                | Request of an operation on resources.                                                                                                                                                  |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | response              | String                                                                                | Response to a user request, that is, the returned information for an operation on resources.                                                                                           |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | code                  | String                                                                                | HTTP status code returned by the associated API.                                                                                                                                       |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | api_version           | String                                                                                | Version of the API.                                                                                                                                                                    |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | message               | String                                                                                | Remarks added by other cloud services to a trace.                                                                                                                                      |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | record_time           | Long                                                                                  | Timestamp when an operation was recorded by CTS.                                                                                                                                       |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | trace_id              | String                                                                                | Trace ID. The value is the UUID generated by the system.                                                                                                                               |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | time                  | Long                                                                                  | Timestamp when a trace was generated.                                                                                                                                                  |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | user                  | :ref:`UserInfo <cts_api_0311__en-us_topic_0000001168237830_response_userinfo>` object | Information of the user who performed the operation that triggered the trace.                                                                                                          |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | service_type          | String                                                                                | Type of a cloud service whose traces are to be queried. The value must be the acronym of a cloud service that has been connected with CTS. It is a word composed of uppercase letters. |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_type         | String                                                                                | Type of the resource on which the operation was performed.                                                                                                                             |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | source_ip             | String                                                                                | IP address of the tenant who performed the operation that triggered the trace.                                                                                                         |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_name         | String                                                                                | Name of a resource on which the recorded operation was performed.                                                                                                                      |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | request_id            | String                                                                                | ID of the recorded request.                                                                                                                                                            |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | location_info         | String                                                                                | Additional information required for fault locating after a request error.                                                                                                              |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | endpoint              | String                                                                                | Endpoint in the details page URL of the cloud resource on which the recorded operation was performed.                                                                                  |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | resource_url          | String                                                                                | Details page URL (excluding the endpoint) of the cloud resource on which the recorded operation was performed.                                                                         |
   +-----------------------+---------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _cts_api_0311__en-us_topic_0000001168237830_response_userinfo:

.. table:: **Table 5** UserInfo

   +-----------+---------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Type                                                                                  | Description                                                                                                                                 |
   +===========+=======================================================================================+=============================================================================================================================================+
   | id        | String                                                                                | Account ID. For details, see section ":ref:`Obtaining an Account ID and Project ID <cts_api_0005>`" in *Cloud Trace Service API Reference*. |
   +-----------+---------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------+
   | name      | String                                                                                | Account name.                                                                                                                               |
   +-----------+---------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------+
   | domain    | :ref:`BaseUser <cts_api_0311__en-us_topic_0000001168237830_response_baseuser>` object | Domain information of the user who performed the operation generating the trace.                                                            |
   +-----------+---------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------+

.. _cts_api_0311__en-us_topic_0000001168237830_response_baseuser:

.. table:: **Table 6** BaseUser

   +-----------+--------+---------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Type   | Description                                                                                                                                 |
   +===========+========+=============================================================================================================================================+
   | id        | String | Account ID. For details, see section ":ref:`Obtaining an Account ID and Project ID <cts_api_0005>`" in *Cloud Trace Service API Reference*. |
   +-----------+--------+---------------------------------------------------------------------------------------------------------------------------------------------+
   | name      | String | Account name.                                                                                                                               |
   +-----------+--------+---------------------------------------------------------------------------------------------------------------------------------------------+

.. _cts_api_0311__en-us_topic_0000001168237830_response_metadata:

.. table:: **Table 7** MetaData

   +-----------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Type    | Description                                                                                                                                                                            |
   +===========+=========+========================================================================================================================================================================================+
   | count     | Integer | Number of returned traces.                                                                                                                                                             |
   +-----------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | marker    | String  | ID of the last trace in the returned trace list. The value of this parameter can be used as the **next** value. If the value of **marker** is **null**, all traces have been returned. |
   +-----------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

**Status code: 400**

.. table:: **Table 8** Response body parameters

   ========== ====== ====================================
   Parameter  Type   Description
   ========== ====== ====================================
   error_code String Error code. Format: **CTS.**\ *XXX*.
   error_msg  String Error message.
   ========== ====== ====================================

**Status code: 401**

.. table:: **Table 9** Response body parameters

   ========== ====== ====================================
   Parameter  Type   Description
   ========== ====== ====================================
   error_code String Error code. Format: **CTS.**\ *XXX*.
   error_msg  String Error message.
   ========== ====== ====================================

**Status code: 403**

.. table:: **Table 10** Response body parameters

   ========== ====== ====================================
   Parameter  Type   Description
   ========== ====== ====================================
   error_code String Error code. Format: **CTS.**\ *XXX*.
   error_msg  String Error message.
   ========== ====== ====================================

**Status code: 404**

.. table:: **Table 11** Response body parameters

   ========== ====== ====================================
   Parameter  Type   Description
   ========== ====== ====================================
   error_code String Error code. Format: **CTS.**\ *XXX*.
   error_msg  String Error message.
   ========== ====== ====================================

**Status code: 500**

.. table:: **Table 12** Response body parameters

   ========== ====== ====================================
   Parameter  Type   Description
   ========== ====== ====================================
   error_code String Error code. Format: **CTS.**\ *XXX*.
   error_msg  String Error message.
   ========== ====== ====================================

**Status code: 503**

.. table:: **Table 13** Response body parameters

   ========== ====== ====================================
   Parameter  Type   Description
   ========== ====== ====================================
   error_code String Error code. Format: **CTS.**\ *XXX*.
   error_msg  String Error message.
   ========== ====== ====================================

Example Request
---------------

-  Querying management traces

   .. code-block:: text

      GET https://{endpoint}/v3/{project_id}/traces?limit=11&to=1479095278000&from=1478490478000&trace_name=createTracker&resource_type=tracker&service_type=CTS&trace_type=system

Example Response
----------------

**Status code: 200**

The request is successful.

.. code-block::

   {
     "meta_data" : {
       "count" : 2,
       "marker" : "e001ccb8-bc09-11e6-b2cc-2640a43cc6e8"
     },
     "traces" : [ {
       "time" : 1472148708232,
       "user" : {
         "name" : "xxx",
         "domain" : {
           "name" : "xxx",
           "id" : "ded649d814464428ba89d04d7955c93e"
         }
       },
       "response" : {
         "code" : "VPC.0514",
         "message" : "Update port fail."
       },
       "code" : 200,
       "service_type" : "VPC",
       "resource_type" : "eip",
       "resource_name" : "192.144.163.1",
       "resource_id" : "d502809d-0d1d-41ce-9690-784282142ccc",
       "trace_name" : "deleteEip",
       "trace_rating" : "warning",
       "trace_type" : "ConsoleAction",
       "api_version" : "2.0",
       "record_time" : 1481066128032,
       "trace_id" : "e001ccb9-bc09-11e6-b00b-4b2a61338db6"
     }, {
       "time" : 1472148708232,
       "user" : {
         "name" : "xxx",
         "domain" : {
           "name" : "xxx",
           "id" : "ded649d814464428ba89d04d7955c93e"
         }
       },
       "response" : {
         "code" : "VPC.0514",
         "message" : "Update port fail."
       },
       "code" : 200,
       "service_type" : "VPC",
       "resource_type" : "eip",
       "resource_name" : "192.144.163.1",
       "resource_id" : "d502809d-0d1d-41ce-9690-784282142ccc",
       "trace_name" : "deleteEip",
       "trace_rating" : "warning",
       "trace_type" : "ConsoleAction",
       "api_version" : "2.0",
       "record_time" : 1481066128032,
       "trace_id" : "e001ccb8-bc09-11e6-b2cc-2640a43cc6e8"
     } ]
   }

Status Code
-----------

+-------------+---------------------------------------------------------------------------------------------------+
| Status Code | Description                                                                                       |
+=============+===================================================================================================+
| 200         | The request is successful.                                                                        |
+-------------+---------------------------------------------------------------------------------------------------+
| 400         | The query parameters are abnormal.                                                                |
+-------------+---------------------------------------------------------------------------------------------------+
| 401         | The request is rejected due to authentication failure.                                            |
+-------------+---------------------------------------------------------------------------------------------------+
| 403         | The server understood the request but refused to authorize it.                                    |
+-------------+---------------------------------------------------------------------------------------------------+
| 404         | The requested trace does not exist.                                                               |
+-------------+---------------------------------------------------------------------------------------------------+
| 500         | Failed to complete the request because of an internal service error.                              |
+-------------+---------------------------------------------------------------------------------------------------+
| 503         | The requested service is invalid. The client should not repeat the request without modifications. |
+-------------+---------------------------------------------------------------------------------------------------+

Error Code
----------

For details, see :ref:`Error Codes <errorcode>`.
