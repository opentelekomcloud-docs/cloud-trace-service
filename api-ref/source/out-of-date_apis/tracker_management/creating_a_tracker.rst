:original_name: cts_api_0125.html

.. _cts_api_0125:

Creating a Tracker
==================

Function
--------

When you enable CTS, a tracker is automatically created to associate with the cloud services you are using and record all operations on the services. Currently, only one management tracker can be created for a cloud account in a region. Traces are retained in the CTS console for seven days. For long-term storage, you can enable Object Storage Service (OBS) and deliver real-time operation records to OBS buckets.

URI
---

POST /v1.0/{project_id}/tracker

.. table:: **Table 1** Path parameter

   +------------+-----------+--------+-------------------------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                                                 |
   +============+===========+========+=============================================================================================================+
   | project_id | Yes       | String | Project ID. For details about how to obtain a project ID, see :ref:`Obtaining a Project ID <cts_api_0005>`. |
   +------------+-----------+--------+-------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 2** Request body parameters

   +------------------+-----------+----------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter        | Mandatory | Type                                                                 | Description                                                                                                                                                                                                                                                                                                                              |
   +==================+===========+======================================================================+==========================================================================================================================================================================================================================================================================================================================================+
   | bucket_name      | Yes       | String                                                               | OBS bucket name. The value contains 3 to 63 characters and must start with a digit or lowercase letter. Only lowercase letters, digits, hyphens (-), and periods (.) are allowed.                                                                                                                                                        |
   +------------------+-----------+----------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | file_prefix_name | No        | String                                                               | Prefix of trace files that need to be stored in OBS buckets. The value can contain 0 to 64 characters, including letters, digits, hyphens (-), underscores (_), and periods (.).                                                                                                                                                         |
   +------------------+-----------+----------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | is_obs_created   | No        | Boolean                                                              | Whether an OBS bucket is created. The default value is **false**. If the value is **true**, an OBS bucket will be created to store trace files. If the value is **false**, trace files will be stored in an existing OBS bucket. A bucket name contains 3 to 64 characters, including digits, letters, and a hyphen (-) or a period (.). |
   +------------------+-----------+----------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | lts              | No        | :ref:`Lts <cts_api_0125__en-us_topic_0257057505_request_lts>` object | Dump LTS.                                                                                                                                                                                                                                                                                                                                |
   +------------------+-----------+----------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _cts_api_0125__en-us_topic_0257057505_request_lts:

.. table:: **Table 3** Lts

   +----------------+-----------+---------+------------------------------------------------------------------+
   | Parameter      | Mandatory | Type    | Description                                                      |
   +================+===========+=========+==================================================================+
   | is_lts_enabled | Yes       | Boolean | Indicates whether to enable the function of dumping data to LTS. |
   +----------------+-----------+---------+------------------------------------------------------------------+
   | log_group_name | Yes       | String  | Name of the log group that CTS creates in LTS.                   |
   +----------------+-----------+---------+------------------------------------------------------------------+
   | log_topic_name | Yes       | String  | Name of the log topic that CTS creates in LTS.                   |
   +----------------+-----------+---------+------------------------------------------------------------------+

Response Parameters
-------------------

**Status code: 201**

.. table:: **Table 4** Response body parameters

   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+
   | Parameter    | Type                                                                          | Description                                                                                                   |
   +==============+===============================================================================+===============================================================================================================+
   | id           | String                                                                        | Unique tracker ID.                                                                                            |
   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+
   | create_time  | Long                                                                          | Timestamp when the tracker was created.                                                                       |
   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+
   | domain_id    | String                                                                        | Account ID. For details about how to obtain an account ID, see :ref:`Obtaining an Account ID <cts_api_0005>`. |
   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+
   | project_id   | String                                                                        | Project ID.                                                                                                   |
   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+
   | obs_info     | :ref:`ObsInfo <cts_api_0125__en-us_topic_0257057505_response_obsinfo>` object | Information about the bucket to which traces are transferred.                                                 |
   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+
   | status       | String                                                                        | Status of a tracker. The value **enabled** indicates normal status.                                           |
   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+
   | tracker_name | String                                                                        | Tracker name.                                                                                                 |
   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+
   | tracker_type | String                                                                        | Tracker type.                                                                                                 |
   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+
   | group_id     | String                                                                        | Unique ID of a log group.                                                                                     |
   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+
   | stream_id    | String                                                                        | Unique ID of a log stream.                                                                                    |
   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+
   | lts          | :ref:`Lts <cts_api_0125__en-us_topic_0257057505_response_lts>` object         | Dump LTS.                                                                                                     |
   +--------------+-------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+

.. _cts_api_0125__en-us_topic_0257057505_response_obsinfo:

.. table:: **Table 5** ObsInfo

   +----------------------+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter            | Type    | Description                                                                                                                                                                       |
   +======================+=========+===================================================================================================================================================================================+
   | bucket_name          | String  | OBS bucket name. The value contains 3 to 63 characters and must start with a digit or lowercase letter. Only lowercase letters, digits, hyphens (-), and periods (.) are allowed. |
   +----------------------+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | file_prefix_name     | String  | Prefix of trace files that need to be stored in OBS buckets. The value can contain 0 to 64 characters, including letters, digits, hyphens (-), underscores (_), and periods (.).  |
   +----------------------+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | is_obs_created       | Boolean | Whether the OBS bucket is automatically created by the tracker.                                                                                                                   |
   +----------------------+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | is_authorized_bucket | Boolean | Whether CTS has been granted permissions to perform operations on the OBS bucket.                                                                                                 |
   +----------------------+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | bucket_lifecycle     | String  | Duration that traces are stored in the OBS bucket.                                                                                                                                |
   +----------------------+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | bucket_location      | String  | Region where the OBS bucket is located.                                                                                                                                           |
   +----------------------+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _cts_api_0125__en-us_topic_0257057505_response_lts:

.. table:: **Table 6** Lts

   +----------------+---------+------------------------------------------------------------------+
   | Parameter      | Type    | Description                                                      |
   +================+=========+==================================================================+
   | is_lts_enabled | Boolean | Indicates whether to enable the function of dumping data to LTS. |
   +----------------+---------+------------------------------------------------------------------+
   | log_group_name | String  | Name of the log group that CTS creates in LTS.                   |
   +----------------+---------+------------------------------------------------------------------+
   | log_topic_name | String  | Name of the log topic that CTS creates in LTS.                   |
   +----------------+---------+------------------------------------------------------------------+

Example Request
---------------

.. code-block:: text

   POST https://{endpoint}/v1.0/{project_id}/tracker

   {
    "bucket_name": "obs-f1da",
    "is_obs_created": true,
    "file_prefix_name": "yO8Q",
    "lts": {
     "is_lts_enabled": true,
     "log_group_name": "CTS",
     "log_topic_name": 'system-trace'
    }
   }

Example Response
----------------

**Status code: 201**

The request is successfully sent.

.. code-block::

   {
     "id" : "2e6fa9b8-8c6e-456d-b5d3-77be972d220b",
     "create_time" : 1587958482923,
     "domain_id" : "aexxxxxxxx4d4fb4bexxxxxxx791fbf",
     "obs_info" : {
       "bucket_name" : "obs-f1da",
       "file_prefix_name" : "yO8Q"
     },
     "project_id" : "bb1xxxxxxxxe4f498cbxxxxxxxx35634",
     "lts" : {
       "is_lts_enabled" : true,
       "log_group_name" : "CTS",
       "log_topic_name" : "system-trace"
     },
     "tracker_name" : "system",
     "tracker_type" : "system",
     "status" : "enabled"
   }

Status Codes
------------

+-------------+----------------------------------------------------------------------+
| Status Code | Description                                                          |
+=============+======================================================================+
| 201         | The request is successfully sent.                                    |
+-------------+----------------------------------------------------------------------+
| 400         | The server failed to process the request.                            |
+-------------+----------------------------------------------------------------------+
| 401         | The request is rejected due to authentication failure.               |
+-------------+----------------------------------------------------------------------+
| 403         | The server understood the request but refused to authorize it.       |
+-------------+----------------------------------------------------------------------+
| 404         | The requested OBS bucket does not exist.                             |
+-------------+----------------------------------------------------------------------+
| 500         | Failed to complete the request because of an internal service error. |
+-------------+----------------------------------------------------------------------+

Error Codes
-----------

For details, see :ref:`Error Codes <errorcode>`.
